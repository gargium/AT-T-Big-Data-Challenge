{% extends "layout.html" %}

{% block body %}
<div id="map"></div>
<script>

  var map;
  function initMap() {
    map = new google.maps.Map(document.getElementById('map'), {
      zoom: 9,
      center: {lat: 37.6, lng: -121.8}
    });

    var sanFrancisco = new google.maps.Data();
    var sanRamon = new google.maps.Data();
    var santaClara = new google.maps.Data();

    // NOTE: This uses cross-domain XHR, and may not work on older browsers.
    sanFrancisco.loadGeoJson("{{urlSF}}");
    sanFrancisco.setStyle(function(feature) {
        var tract = feature.getProperty('TRACT');
        var color = 0;
        var sfBSIList = {{ sfBSIs | safe }}
        if ( tract in sfBSIList) {
            bsiVal = sfBSIList[tract]
            if ( bsiVal > 0.5)
                color = 'green';
            else if ( bsiVal > 0 )
                color = 'yellow';
            else if ( bsiVal > -.5 )
                color = 'orange';
            else color = 'red';
        } else {
            color = 'grey'
        }
        return {
          fillColor: color,
          strokeWeight: 0.5

        };
    });
    sanRamon.loadGeoJson("{{urlSR}}");
    sanRamon.setStyle(function(feature) {
        var tract = feature.getProperty('TRACT');
        var color = 0;

        var srBSIList = {{ srBSIs | safe }}
         if ( tract in srBSIList ) {
            bsiVal = srBSIList[tract]
            if ( bsiVal > 0.5)
                color = 'green';
            else if ( bsiVal > 0 )
                color = 'yellow';
            else if ( bsiVal > -.5 )
                color = 'orange';
            else color = 'red';
        } else {
            color = 'grey'
        }
        return {
          fillColor: color,
          strokeWeight: 0.5
        };
    });

    santaClara.loadGeoJson("{{urlSC}}");
    santaClara.setStyle(function(feature) {
        var tract = feature.getProperty('TRACT');
        var color = 0;
        var scBSIList = {{ scBSIs | safe }}
        if ( tract in scBSIList ) {
            bsiVal = scBSIList[tract]
            if ( bsiVal > 0.5)
                color = 'green';
            else if ( bsiVal > 0 )
                color = 'yellow';
            else if ( bsiVal > -.5 )
                color = 'orange';
            else color = 'red';
        } else {
            color = 'grey'
        }
        return {
          fillColor: color,
          strokeWeight: 0.5
        };
    });

    sanFrancisco.setMap(map);
    sanRamon.setMap(map);
    santaClara.setMap(map);
  }
</script>
<script async defer
src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD15D-YDkctUbztUo2IeDxnXuj3rlBgQsE&callback=initMap">
</script>
{% endblock %}
